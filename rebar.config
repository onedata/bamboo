%% behaviours should be compiled before other files
{erl_first_files, [
    "src/veil_modules/worker_plugin_behaviour.erl",
    "src/veil_modules/control_panel/rest_modules/rest_module_behaviour.erl"
]}.

%% directory for releases
{sub_dirs, ["rel"]}.

%% deps options
{deps, [
    {lager, "2.0.3", {git, "git://github.com/basho/lager.git", {tag, "2.0.3"}}},
    {n2o, ".*", {git, "git://github.com/5HT/n2o", {tag, "1.1.0"}}},
    {cowboy, "0.8.6", {git, "git://github.com/extend/cowboy.git", {tag, "0.8.6"}}},
    {ibrowse, "4.0.1", {git, "git://github.com/cmullaparthi/ibrowse.git", {tag, "v4.0.1"}}},
    {mochiweb, ".*", {git, "https://github.com/mochi/mochiweb.git", {tag, "b37b6fe"}}}
]}.

%% generation pre-hooks
{pre_hooks, [
    {compile, "mkdir -p c_lib"}
]}.

{post_hooks, [
    {compile, "chmod +x c_src/link_shared.sh"},
    {compile, "./c_src/link_shared.sh botan-1.10 gr_adapter_drv.so"},
    {compile, "rm -rf c_lib/*.a"}
]}.

%% cleanup directories
{clean_files, ["c_lib"]}.

%% Erlang NIF specification
{port_specs, [
    {"c_lib/gr_adapter_drv.so", ["c_src/gr_adapter.cc", "c_src/gr_adapter_nif.cc"]}
]}.

%% Erlang NIF compilation flags
{port_env, [
    {"LDFLAGS", "$LDFLAGS -Wl,-rpath,c_lib -L c_lib -lbotan-1.10 -Wl,-z"},
    {"CXXFLAGS", "$CXXFLAGS -O2 -ansi -W -Wall `pkg-config --libs --cflags botan-1.10`"}
]}.

%% Logging
%% Add the tuple below to erl_opts proplist to completely turn off debug messages
%% {d, skip_debug}
{erl_opts, [
    fail_on_warning,
    debug_info,
    {parse_transform, lager_transform}
]}.

% Options for erlyDTL (templates for GUI)
{erlydtl_opts, [
    {doc_root, "src/gui_static/templates"},
    {out_dir, "ebin"},
    {source_ext, ".html"},
    {module_ext, "_view"}
]}.